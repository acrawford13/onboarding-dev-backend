/* eslint-disable global-require */
const path = require('path');
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors')
const { Map, List } = require('immutable');

const { errorHandling, originValidation } = require('./src/middlewares');

const PORT = process.env.PORT || 3030;
const HOST = process.env.HOST || 'localhost';

const app = express();

app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(cors({ origin: true, methods: ['GET', 'PUT', 'POST', 'DELETE'] }))

app.get(
  '/onboarding/v1/onboardings/:uiid',
  (req, res) => {
    console.log('>>>> Get all for: ', req.params);
    res.status(200).json(data.toJS());
  }
);

app.put(
  '/onboarding/v1/onboardings/:uiid/location', (req, res) => {
    console.log('>>>> Update location', req.body.location);
    data = data.setIn('location', req.body.location);
    res.status(200).json({ location: req.body.location });
  })

app.put(
  '/onboarding/v1/onboardings/:uiid', (req, res) => {
    const { field } = req.body;
    const path = ['data'].concat(field.resource.split('.'), field.column);
    console.log('>>>> Update field', req.body, path);
    data = data.setIn(path, field.value);
    res.status(200).json({ field });
  })
app.use(errorHandling);

app.listen(PORT, HOST, () => {
  console.log(`Server listing on ${HOST}:${PORT}`);
});

var data = Map({
  "location": "/info/1",
  "enabled": true,
  "finished": false,
  "codelist": {
    "amenities": [
      {
        "category": "kitchen_appliances",
        "data": [
          {
            "id": 155,
            "name": "stove",
            "kinds": [
              "electric",
              "gas",
              "induction"
            ],
            "show_description": true,
            "icon": 'M42.667 512v469.333h938.667v-469.333h-938.667zM21.333 469.333h981.333c11.782 0 21.333 9.551 21.333 21.333v512c0 11.782-9.551 21.333-21.333 21.333h-981.333c-11.782 0-21.333-9.551-21.333-21.333v-512c0-11.782 9.551-21.333 21.333-21.333zM256 725.333v256h512v-256h-512zM234.667 682.667h554.667c11.782 0 21.333 9.551 21.333 21.333v298.667c0 11.782-9.551 21.333-21.333 21.333h-554.667c-11.782 0-21.333-9.551-21.333-21.333v-298.667c0-11.782 9.551-21.333 21.333-21.333zM666.61 42.057c-18.654-13.726-5.143-43.166 17.427-37.973 106.444 24.492 185.467 125.909 185.467 235.745 0 79.622-64.549 144.171-144.171 144.171-79.614 0-144.171-64.541-144.171-144.128 0-57.533 32.497-104.428 90.23-127.31 13.043-5.169 27.438 3.442 29.052 17.379 0.329 2.841 1.018 5.534 2.138 8.191 5.132-32.879-6.436-74.34-35.974-96.075zM727.833 190.165c-6.952 10.558-21.508 12.788-31.303 4.797-13.43-10.957-23.249-21.185-29.688-32.585-28.354 17.721-43.013 44.699-43.013 77.495 0 56.021 45.452 101.461 101.504 101.461 56.058 0 101.504-45.446 101.504-101.504 0-66.010-35.115-128.746-88.039-165.455 13.137 40.234 9.164 85.222-10.965 115.79zM597.333 426.667v42.667h256v-42.667h-256zM576 384h298.667c11.782 0 21.333 9.551 21.333 21.333v85.333c0 11.782-9.551 21.333-21.333 21.333h-298.667c-11.782 0-21.333-9.551-21.333-21.333v-85.333c0-11.782 9.551-21.333 21.333-21.333zM239.943 42.057c-18.654-13.726-5.143-43.166 17.427-37.973 106.444 24.492 185.467 125.909 185.467 235.745 0 79.622-64.549 144.171-144.171 144.171s-144.171-64.549-144.171-144.171c0-57.514 32.521-104.443 90.245-127.273 13.040-5.158 27.425 3.454 29.038 17.384 0.329 2.841 1.018 5.534 2.138 8.191 5.132-32.879-6.436-74.34-35.974-96.075zM301.167 190.165c-6.952 10.558-21.508 12.788-31.303 4.797-13.434-10.96-23.255-21.191-29.694-32.596-28.339 17.7-43.007 44.688-43.007 77.464 0 56.058 45.446 101.504 101.504 101.504s101.504-45.446 101.504-101.504c0-66.010-35.115-128.746-88.039-165.455 13.137 40.234 9.164 85.222-10.965 115.79zM170.667 426.667v42.667h256v-42.667h-256zM149.333 384h298.667c11.782 0 21.333 9.551 21.333 21.333v85.333c0 11.782-9.551 21.333-21.333 21.333h-298.667c-11.782 0-21.333-9.551-21.333-21.333v-85.333c0-11.782 9.551-21.333 21.333-21.333zM384 810.667c-11.782 0-21.333-9.551-21.333-21.333s9.551-21.333 21.333-21.333h256c11.782 0 21.333 9.551 21.333 21.333s-9.551 21.333-21.333 21.333h-256zM343.922 552.079c24.994 24.994 24.994 65.516 0 90.51s-65.516 24.994-90.51 0c-24.994-24.994-24.994-65.516 0-90.51s65.516-24.994 90.51 0l-0-0zM313.752 582.249c-8.331-8.331-21.839-8.331-30.17 0s-8.331 21.839 0 30.17c8.331 8.331 21.839 8.331 30.17-0s8.331-21.839-0-30.17l-0-0zM770.588 552.079c24.994 24.994 24.994 65.516 0 90.51s-65.516 24.994-90.51 0c-24.994-24.994-24.994-65.516 0-90.51s65.516-24.994 90.51 0l-0-0zM740.418 582.249c-8.331-8.331-21.839-8.331-30.17 0s-8.331 21.839 0 30.17c8.331 8.331 21.839 8.331 30.17-0s8.331-21.839-0-30.17l-0-0z'
          },
          {
            "id": 200,
            "name": "fridge",
            "kinds": [],
            "show_description": true,
            "icon": 'M170.667 106.667v768c0 35.322 28.678 64 64 64h554.667c35.322 0 64-28.678 64-64v-768c0-35.322-28.678-64-64-64h-554.667c-35.322 0-64 28.678-64 64zM128 106.667c0-58.886 47.781-106.667 106.667-106.667h554.667c58.886 0 106.667 47.781 106.667 106.667v768c0 58.886-47.781 106.667-106.667 106.667h-554.667c-58.886 0-106.667-47.781-106.667-106.667v-768zM298.667 1024h-42.667v-64h42.667v64zM768 1024h-42.667v-64h42.667v64zM149.333 384v-42.667h725.333v42.667h-725.333zM256 128h42.667v128h-42.667v-128zM256 426.667h42.667v256h-42.667v-256z'
          }
        ]
      },
      {
        "category": "kitchen_amenities",
        "data": [
          {
            "id": 156,
            "name": "scissors",
            "kinds": [],
            "show_description": false,
            "icon": 'M296.85 888.679c-66.65 66.65-174.71 66.65-241.359 0s-66.65-174.71 0-241.359c66.65-66.65 174.71-66.65 241.359 0s66.65 174.71 0 241.359zM85.661 677.489c-49.987 49.987-49.987 131.032 0 181.019s131.032 49.987 181.019 0c49.987-49.987 49.987-131.032 0-181.019s-131.032-49.987-181.019 0zM964.566 246.804c-22.045-17.809-56.299-22.451-80.528-8.174l-678.784 399.531c-10.154 5.976-23.23 2.59-29.206-7.564s-2.59-23.23 7.564-29.206l678.775-399.525c50.757-29.91 123.226-11.19 153.152 39.54 5.972 10.124 2.63 23.171-7.474 29.177l-436.992 259.755c-10.128 6.020-23.219 2.69-29.239-7.438s-2.69-23.219 7.438-29.239l415.295-246.858zM296.85 376.679c-66.65 66.65-174.709 66.65-241.359 0s-66.65-174.709 0-241.359c66.65-66.65 174.709-66.65 241.359 0s66.65 174.709 0 241.359zM85.661 165.49c-49.987 49.987-49.987 131.032 0 181.019s131.032 49.987 181.019 0c49.987-49.987 49.987-131.032 0-181.019s-131.032-49.987-181.019 0zM964.628 777.1l-505.356-300.914c-10.123-6.028-13.443-19.121-7.415-29.244s19.121-13.443 29.244-7.415l527.019 313.813c10.094 6.010 13.429 19.051 7.46 29.169-29.936 50.748-102.421 69.489-153.154 39.539l-675.755-398.336c-10.15-5.983-13.528-19.061-7.545-29.211s19.061-13.528 29.211-7.545l675.766 398.343c24.212 14.293 58.477 9.637 80.524-8.198z'
          },
          {
            "id": 206,
            "name": "peeler",
            "kinds": [],
            "show_description": false,
            "icon": 'M804.761 32.274c-9.969-10.236-23.32-15.874-37.598-15.874-25.445 0-46.704 18.271-51.415 42.405h-6.738v-42.64c0-8.93-7.224-16.165-16.134-16.165h-363.705c-8.911 0-16.134 7.236-16.134 16.165v42.637h-6.738c-4.711-24.134-25.968-42.405-51.415-42.405-14.267 0-27.614 5.638-37.578 15.874-9.917 10.193-15.186 23.621-14.829 37.816 3.274 130.76 86.988 242.625 201.612 286.483l0.054 556.891c-0.927 29.192 9.711 56.826 29.978 77.841 20.332 21.084 47.644 32.697 76.905 32.697s56.572-11.613 76.903-32.697c20.265-21.015 30.905-48.649 29.978-77.841l0.054-556.238c51.736-19.502 98.351-53.755 133.574-98.664 42.21-53.817 66.373-120.787 68.040-188.569 0.346-14.154-4.913-27.55-14.814-37.717zM345.305 41.793h331.438v44.404h-331.438v-44.404zM345.693 125.593h330.662c8.101 0 14.669-6.303 14.669-14.082v-16.65h4.551c-8.050 84.395-87.739 150.886-184.55 150.886s-176.5-66.491-184.55-150.886h4.551v16.65c-0.002 7.779 6.566 14.082 14.667 14.082zM579.57 363.91l-0.049 480.694c0.654 18.487-5.434 103.753-18.469 116.706-13.033 12.949-30.539 20.082-49.295 20.082s-36.264-7.133-49.297-20.082c-13.035-12.951-11.239-98.708-10.593-116.706 0.004-0.109-3.127-160.446-9.392-481.011 22.003 5.447-14.182 0.317 9.392 0.317l-8.058-30.71c-108.426-33.19-206.377-154.23-209.277-265.199-0.124-4.757 4.793-7.632 8.275-11.060 3.525-3.47 13.983-4.949 19.027-4.949 10.189 0 32.52 39.688 32.52 49.469v5.341c0 107.536 97.195 171.895 216.667 171.895s194.053-60.894 216.671-171.895v-5.345c0-9.781 28.828-49.902 39.021-49.902 5.052 0 9.778 1.913 13.307 5.386 3.466 3.411 0.12 18.951 0 23.676-1.115 43.454-22.183 97.781-59.376 144.472-41.828 52.509-102.319 95.926-144.373 114.273-9.834 4.29-4.386 25.994 3.298 24.549z'
          }
        ]
      }
    ]
  },
  "data": Map({
    "host": Map({
      "name": "Joe Doe",
      "email": "joe.doe@example.com",
      "phone": "+1671991501289",
      "contact": "",
      "alternative_contact": "",
      "minimum_nightly_price": "",
      "observations": "",
      "bank_details": Map({
        "country": "uk",
        "account_number": "123456",
        "swift": "222333"
      })
    }),
    "property": Map({
      "property_type": "flat",
      "residency_type": "",
      "property_type_observations": "",
      "city": "",
      "street": "",
      "street_number": "",
      "post_code": "",
      "floor": "",
      "flat_number": "",
      "address_observations": "",
      "building_directions": "",
      "flat_directions": "",
      "aditional_comments": "",
      "intercom": false,
      "alarm": false,
      "lockbox": false,
      "doors_lock_when_closed": false,
      "lock_observations": "",
      "set_of_keys": "",
      "keys_descriptions": "",
      "all_keys_tested": false,
      "keys_observations": "",
      "closest_public_transport": "",
      "parking_nearby": false,
      "transport_observations": "",
      "size": 156,
      "max_guest_number": "",
      "size_observations": "",
      "wifi_name": "",
      "wifi_password": "",
      "wifi_router_location": "",
      "wifi_observations": "",
      "bedrooms_count": 2,
      "pillow_for_all_beds": false,
      "bedrooms_observations": "",
      "bathrooms_instructions": "",
      "bathrooms_observations": "",
      "beds": List([
        {
          "location": "Bedroom One",
          "count": 1,
          "type": "queen_bed"
        },
        {
          "location": "Bedroom Two",
          "count": 2,
          "type": "single_bed"
        }
      ]),
      "bathrooms": List([
        {
          "shower": true,
          "bathtub": false,
          "toilet": false,
          "hairdryer": true
        },
        {
          "shower": false,
          "bathtub": true,
          "toilet": true,
          "hairdryer": false
        }
      ]),
      "amenities": List([
        {
          "amenity_id": 155,
          "property_amenity_id": 1,
          "kind": "electric",
          "description": "Alo mundo"
        },
        {
          "amenity_id": 156,
          "property_amenity_id": 2,
          "kind": "",
          "description": ""
        }
      ]),
      "maintenance": Map({
        "waste_disposal_directions": "",
        "cleaning_instructions": "",
        "extra_linen_place": "",
        "dirty_linen_place": "",
        "preferred_maintenance": "",
        "switches_location": "",
        "boiler_location": "",
        "heating_control_location": "",
        "internal_keys": true,
        "observations": ""
      }),
      "aditional_infos": Map({
        "rules": "",
        "children_friendly": true,
        "infant_friendly": true,
        "rules_observations": "",
        "private_room": true,
        "property_truths": "",
        "letterbox_access": true,
        "posts_location": "",
        "aditional_observations": ""
      }),
      "nearby": Map({
        "supermarkets_and_shops": "",
        "cafe_or_restaurant": "",
        "points_of_interest": ""
      })
    })
  })
});
